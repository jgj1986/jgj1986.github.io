<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="author" content="jgj" />
        <meta name="viewport" content="width=device-width" /> 
        <title>Nodemcu_basic | 我是疯子</title>
        
        <meta name="keywords" content="" />
        

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- bootstrap source -->
        <!-- 新 Bootstrap 核心 CSS 文件 -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <!-- 可选的Bootstrap主题文件（一般不用引入） -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
        <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
        <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
        <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
        <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="/asset/css/kissdata.css" />

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <link href="/feed.html" rel="alternate" title="jgj" type="application/atom+xml" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="icon" href="/favicon.ico" />

        <style type="text/css">
            body {
                padding-top: 55px;
                padding-bottom: 30px;
                background-color: #EEE;
            }
        </style>

        <link rel="stylesheet" href="/asset/js/google-code-prettify/prettify.css">
        <script src="/asset/js/google-code-prettify/prettify.js"></script>

        <script type="text/javascript">
            $(document).ready(function () {

                // go to top
                var bt = $('#toolBackTop'); var sw = $(document.body)[0].clientWidth; var limitsw = (sw - 840) / 2 - 80; if (limitsw > 0){ limitsw = parseInt(limitsw); bt.css("right",limitsw); } $(window).scroll(function() { var st = $(window).scrollTop(); if(st > 30){ bt.show(); }else{ bt.hide(); } });

                // google-code-prettify
                $("pre").addClass("prettyprint linenums"); prettyPrint();

            })
        </script>

        <!-- kp747 
        
        -->
    </head>
    <body>
            <div id="header">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand normal-a" href="javascript:void(0)" onclick="javascript:void(0)">
                    <span id="site_name">我是疯子</span>
                </a>
            </div>

            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/categories.html">分类</a></li>
                    <li><a href="/guestbook.html">留言</a></li>
                    <li><a href="/about.html">关于</a></li>
                    <li><a href="/feed.html">RSS</a></li>
                    <li><a href="javascript:void(0)" class="normal-a" onclick="javascript:void(0)"><span id="site_description">在此停留片刻，偶有所得！</span></a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
</div>


            <div class="container">
                <div class="row">
                    <div class="col-md-9" id="main-left">
                        <div class="page">
    <div class="head">
        <div class="title">Nodemcu_basic</div>
        <div class="date">date: 2015-11-04</div>
    </div>
    <hr class="middle-margin" />


    <!-- google adsense -->
    <!--
    <div>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:inline-block;width:728px;height:90px"
            data-ad-client="ca-pub-1339945837472110"
            data-ad-slot="9657522081"></ins>
        <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
    </div>
    <hr class="middle-margin" />
    -->

    <div class="content">
        <ul id="markdown-toc">
  <li><a href="#section">入门</a></li>
  <li><a href="#minicom">minicom控制</a></li>
  <li><a href="#arduino">Arduino</a></li>
  <li><a href="#mqtt">使用mqtt协议远程操控</a></li>
  <li><a href="#section-1">固件编译、烧写</a></li>
  <li><a href="#section-2">代码加载与执行</a></li>
  <li><a href="#section-3">总结</a></li>
</ul>

<h2 id="section">入门</h2>
<p>NodeMcu论坛上有一篇比较好的入门文章<a href="http://bbs.nodemcu.com/t/nodemcu/104" target="_blank">NodeMcu三小时入门</a>，开始时按照里面的步骤，烧写固件。
这个过程中遇到了两个问题：
1、USB驱动，提示的的CP2102 usb to uart bridge controller 的驱动有问题，那就不要在使用CH340的驱动了。Windows7系统自己不能识别，则网上搜集CP2102的驱动下载安装。
2、固件烧写，曾经尝试烧写了两个版本，2014xx和20150122的，但是之后在连接时没有输出，或者输出不能输入，是因为固件版本还是太低，而硬件已经是高级别的硬件了。到github上去下载最近的<a href="https://github.com/nodemcu/nodemcu-flasher" target="_blank">flasher</a>和<a href="https://github.com/nodemcu/nodemcu-firmware" target="_blank">固件</a>。使用较新版本烧写之后连接，则可以测试lua的helloworld了。</p>

<p>后续测试连接wifi，获取网络地址的时候，可能要等待一段时间才得到ip地址。</p>

<h2 id="minicom">minicom控制</h2>

<p>Linux上使用minicom也可以控制NodeMcu，将已经烧写过固件的板子连接到Linux系统上，会有 /dev/ttyUSB0。
minicom中的一些配置如下: </p>

<pre><code>Serial Device: /dev/ttyUSB0
Bps/Par/Bits    : 9600 8N1
Hardware Flow Control                       : No
Software Flow Control : No
</code></pre>

<p>之后 RST 键重启下开发板，</p>

<pre><code>NodeMCU 0.9.5 build 20150318  powered by Lua 5.1.4                                                                                                     
lua: cannot open init.lua                                                                                                                          
&gt; print("helloworld world") 
hello world
</code></pre>

<p>参考: <a href="http://www.allaboutcircuits.com/projects/how-to-make-an-interactive-tcp-server-nodemcu-on-the-esp8266/" target="_blank">How to Make an Interactive TCP Server    with NodeMCU on the ESP8266</a>，</p>

<h2 id="arduino">Arduino</h2>

<p>还可以使用Arduino来操控nodemcu，<a href="http://wiki.jackslab.org/Getting_Started_with_Noduino_on_Windows" target="_blank">Getting Started with Noduino on Windows</a></p>

<h2 id="mqtt">使用mqtt协议远程操控</h2>

<p><a href="http://www.allaboutcircuits.com/projects/introduction-to-the-mqtt-protocol-on-nodemcu/" target="_blank">Introduction to the MQTT Protocol on NodeMCU</a> 
介绍了使用使用开源的mqtt项目<a href="http://mosquitto.org/" target="_blank">mosquitto</a>做服务端，<a href="https://www.eclipse.org/paho/clients/python/">Paho Python Client</a>做客户端，
达到控制LED等的效果。</p>

<h2 id="section-1">固件编译、烧写</h2>

<p>在前面提到，烧写固件时，选用老版本固件会出现一些问题，于是决定使用 <a href="https://github.com/nodemcu/nodemcu-firmware" target="_blank">github</a>上的代码，重新编译一份。</p>

<p>要使用相应编译工具链，tools/esp-open-sdk.tar.gz，解析得到xtensa-lx106-elf，</p>

<pre><code>$ export PATH=$PATH:/path/to/tools/esp-open-sdk/xtensa-lx106-elf/bin
$ make
$ ls bin
0x00000.bin  0x10000.bin
</code></pre>

<p>这两个bin是刚生成的。使用esptools.py 命名烧写到板子上，参考 <a href="https://github.com/themadinventor/esptool" target="_blank">esptool的github</a></p>

<pre><code>$ sudo ./tools/esptool.py -p /dev/ttyUSB0 -b 9600 write_flash 0x00000 ./bin/0x00000.bin
$ sudo ./tools/esptool.py -p /dev/ttyUSB0 -b 9600 write_flash 0x10000 ./bin/0x10000.bin
</code></pre>

<p>结果不好使。尝试使用flasher工具中自带的固件(git仓库下载后的 nodemcu-flasher-master/Resources/Binaries/nodemcu_integer_0.9.5_20150318.bin)，使用相同的方式写入，也是同样的问题：<br />
乱码显示后没有等待输入的界面。<br />
改变烧写模式，默认的是 <code>gio</code>，换为<code>dio</code>:</p>

<pre><code>$ ./tools/esptool.py write_flash -h
...
--flash_mode {qio,qout,dio,dout}, -fm {qio,qout,dio,dout}
...
$ sudo ./tools/esptool.py -p /dev/ttyUSB0 115200 write_flash -fm dio 0x10000 /path/to/nodemcu_integer_0.9.5_20150318.bin
</code></pre>

<p>烧写完成后，使用minicom连接，RTS重启下，就进入 输入界面，可以正常交互了。发现上面-b 设置不同的波特率，会影响烧写的速度，除此之外没有看到别的影响。使用这种方式，烧写编译好的两个bin文件</p>

<pre><code>$ sudo ./esptool.py write_flash -fm dio 0x00000 ../nodemcu-firmware/bin/0x00000.bin
$ sudo ./esptool.py write_flash -fm dio 0x10000 ../nodemcu-firmware/bin/0x10000.bin
</code></pre>

<p>烧写完成后，第一次进入，有个提示  Self adjust flash size，然后没有反应。重新使用minicom连接，就可以正常交互了。</p>

<h2 id="section-2">代码加载与执行</h2>

<p>在前面的 <code>minicom 控制</code>和<code>使用mqtt协议远程操控</code>章节，都应用了 <code>http://www.allaboutcircuits.com/</code> 上面的文章，里面用到了工具<a href="https://github.com/4refr0nt/luatool" target="_blank">luatool</a>。</p>

<pre><code>$ ./luatool.py -h
$ ./luatool.py -f net.lua -t net.lua -v 
    # net.lua文件写到板子上，也命名为net.lua,-v显示过程
$ ./luatool.py -f net.lua -t net.lua -d -v
    # -d 加载完成后执行该文件 dofile
</code></pre>

<h2 id="section-3">总结</h2>

<p>到此，在Linux下可以完成Nodemcu的一些最基本操作了。用到了工具 esptool、minicom、luatool等，因为ttyUSB0端口是单操作的，所以在使用执行esptool 或 luatool等命令是，minicom要断开。</p>

    </div>
</div>



    
        <div class="comment">
    
    <!-- duoshuo -->
    
    <div class="ds-thread" data-thread-key="/2015/11/04/nodemcu_basic" data-title="Nodemcu_basic" data-url="http://jgj1986.github.io/2015/11/04/nodemcu_basic.html"></div>
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-woshifengzi"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    

    
    <!-- disqus -->
    
    
    
</div>

    



                    </div>
                    <div class="col-md-3" id="main-right">
                        <div>
    <h4><strong>文章分类</strong></h4>
    <hr class="small-margin colored-hr" />
    <ul class="side-cat-ul">
        
        <li><a href="/categories.html#cat-生活随记" title="生活随记">生活随记 (3)</a></li>
        
        <li><a href="/categories.html#cat-bigdata" title="bigdata">bigdata (9)</a></li>
        
        <li><a href="/categories.html#cat-web" title="web">web (9)</a></li>
        
        <li><a href="/categories.html#cat-database" title="database">database (3)</a></li>
        
        <li><a href="/categories.html#cat-linux" title="linux">linux (10)</a></li>
        
        <li><a href="/categories.html#cat-go" title="go">go (8)</a></li>
        
        <li><a href="/categories.html#cat-运维" title="运维">运维 (3)</a></li>
        
        <li><a href="/categories.html#cat-language" title="language">language (7)</a></li>
        
        <li><a href="/categories.html#cat-tools" title="tools">tools (1)</a></li>
        
        <li><a href="/categories.html#cat-iot" title="iot">iot (5)</a></li>
        
    </ul>
</div>

<hr class="small-margin colored-hr" />

<!-- google adsense -->
<!--
<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
        style="display:inline-block;width:300px;height:600px"
        data-ad-client="ca-pub-1339945837472110"
        data-ad-slot="8220828081"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
-->


                    </div>
                </div>
            </div>

            <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <hr class="colored-hr" />

                <p class="text-center">
                Copyright 2014 - 2016 | Gen time&#58; 2016-04-12 01:51:47 CST

                <!-- cnzz -->
                

                </p>


            </div>
        </div>
    </div>
    <div style="display:none;" class="back-to" id="toolBackTop">
        <a title="返回顶部" onclick="window.scrollTo(0,0);return false;" href="#top" class="back-top">返回顶部</a>
    </div>

    <!-- google analytics -->
    


</div>

    </body>
</html>
