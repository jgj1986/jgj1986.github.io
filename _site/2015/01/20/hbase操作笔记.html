<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="author" content="jgj" />
        <meta name="viewport" content="width=device-width" /> 
        <title>Hbase操作笔记 | 我是疯子</title>
        
        <meta name="keywords" content="" />
        

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- bootstrap source -->
        <!-- 新 Bootstrap 核心 CSS 文件 -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <!-- 可选的Bootstrap主题文件（一般不用引入） -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
        <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
        <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
        <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
        <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="/asset/css/kissdata.css" />

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <link href="/feed.html" rel="alternate" title="jgj" type="application/atom+xml" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="icon" href="/favicon.ico" />

        <style type="text/css">
            body {
                padding-top: 55px;
                padding-bottom: 30px;
                background-color: #EEE;
            }
        </style>

        <link rel="stylesheet" href="/asset/js/google-code-prettify/prettify.css">
        <script src="/asset/js/google-code-prettify/prettify.js"></script>

        <script type="text/javascript">
            $(document).ready(function () {

                // go to top
                var bt = $('#toolBackTop'); var sw = $(document.body)[0].clientWidth; var limitsw = (sw - 840) / 2 - 80; if (limitsw > 0){ limitsw = parseInt(limitsw); bt.css("right",limitsw); } $(window).scroll(function() { var st = $(window).scrollTop(); if(st > 30){ bt.show(); }else{ bt.hide(); } });

                // google-code-prettify
                $("pre").addClass("prettyprint linenums"); prettyPrint();

            })
        </script>

        <!-- kp747 
        
        -->
    </head>
    <body>
            <div id="header">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand normal-a" href="javascript:void(0)" onclick="javascript:void(0)">
                    <span id="site_name">我是疯子</span>
                </a>
            </div>

            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/categories.html">分类</a></li>
                    <li><a href="/guestbook.html">留言</a></li>
                    <li><a href="/about.html">关于</a></li>
                    <li><a href="/feed.html">RSS</a></li>
                    <li><a href="javascript:void(0)" class="normal-a" onclick="javascript:void(0)"><span id="site_description">在此停留片刻，偶有所得！</span></a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
</div>


            <div class="container">
                <div class="row">
                    <div class="col-md-9" id="main-left">
                        <div class="page">
    <div class="head">
        <div class="title">Hbase操作笔记</div>
        <div class="date">date: 2015-01-20</div>
    </div>
    <hr class="middle-margin" />


    <!-- google adsense -->
    <!--
    <div>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:inline-block;width:728px;height:90px"
            data-ad-client="ca-pub-1339945837472110"
            data-ad-slot="9657522081"></ins>
        <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
    </div>
    <hr class="middle-margin" />
    -->

    <div class="content">
        <ul id="markdown-toc">
  <li><a href="#hbase">hbase环境搭建</a>    <ul>
      <li><a href="#standalone">standalone</a></li>
      <li><a href="#section">集群</a></li>
    </ul>
  </li>
  <li><a href="#hbase-">访问hbase 的操作</a>    <ul>
      <li><a href="#go--hbase">go 访问 hbase</a></li>
      <li><a href="#python--hbase">python 访问 hbase</a></li>
    </ul>
  </li>
  <li><a href="#section-1">其他</a></li>
</ul>

<blockquote>
  <p>本文记录从1月13号到1月20号这接近一周时间内一些工作以及遇到的问题，涉及hbase环境的搭建，到 go 语言使用 thrift 操作 hbase，python访问hbase，以及一些琐碎的知识点。</p>
</blockquote>

<h2 id="hbase">hbase环境搭建</h2>

<p>要开发就要有测试，要测试就要有测试环境。先搭建个 hbase 的环境，没有想到单单一个 standalone 的环境就用了 NN 久的时间。</p>

<h3 id="standalone">standalone</h3>

<pre><code>$ tar xzf hbase-0.94.26-bin.tar.gz
$ ln -s hbase-0.94.26 default
$ cat default/conf/hbase-site.xml
&lt;configuration&gt;
&lt;property&gt;
    &lt;name&gt;hbase.rootdir&lt;/name&gt;
    &lt;value&gt;file:///data/hbase&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;hbase.zookeeper.property.dataDir&lt;/name&gt;
    &lt;value&gt;/data/zookeeper&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
$ ./default/bin/start-hbase.sh
starting master, logging to /home/hbase/default/bin/../logs/hbase-master-ubuntu.out
$ ps ax | grep hbase
// 进程没有了   
</code></pre>

<p>根据网上的说明，修改 /etc/host</p>

<pre><code>127.0.0.1   localhost
127.0.0.1   ubuntu
</code></pre>

<p>重新执行 <code>start-hbase.sh</code> 仍然没有启动。
而如果换成用 root   权限或 sudo 来执行，就好了</p>

<pre><code>$ sudo ./start-hbase.sh 
</code></pre>

<h3 id="section">集群</h3>

<p>standalone只是一个初始，集群环境才是我们想要的。这个网上的资料就很多了，还有点需要注意 hdfs 和 hbase 的版本兼容没有问题。<br />
以后使用多了，当整理一篇关于hbase配置的文章。我在安装时，应为 zookeeper 的配置问题，浪费了一些时间。是这样的：
zoo.cfg 中定义zookeeper集群的 多个node，以及 dataLogDir，那就需要在 <code>dataLogDir</code> 目录下建一个 myid 文件，文件的内容为 zoo.cfg 对应的server.id中的id</p>

<p>关于hbase，参考 <a href="http://hbase.apache.org/book.html#quickstart" target="_blank">官方文档</a> 或  <a href="http://abloz.com/hbase/book.html" target="_blank">中文版</a>，
而但就安装而言，我觉得博客 <a href="http://linuxjcq.blog.51cto.com/3042600/760634/" target="_blank">Hbase安装配置（含分布式ZooKeeper）</a>是比较清晰的。</p>

<h2 id="hbase-">访问hbase 的操作</h2>

<h3 id="go--hbase">go 访问 hbase</h3>

<p>这个项目是使用hbase来存放要查询的设备id，而为了达到实时计算的目的，使用 heka  插件了进行，为此使用 go 通过 thrift 来操作 hbase。
文冠的博客 <a href="http://blog.kissdata.com/2014/08/04/golang-thrift-hbase.html" target="_blank">golang通过thrift操作Hbase</a>就是做这个介绍的。
其实得到的结果是，thrift上和hbase集群使用了相同的配置，启动后就能直接访问hbase了。
这样，在实际的操作过程中，就是thrift的接口。</p>

<pre><code>$ ./hbase thrift2 -p 9090 start
</code></pre>

<p>列举go 访问hbase 的几个关键代码点</p>

<pre><code>import  git.apache.org/thrift.git/lib/go/thrift

hbaseThriftTrans, hbaseThriftClient, err := hbase.HbaseOpenThriftConnection(mj.hbaseHost, mj.hbasePort);

tput := &amp;hbase.TPut{
    Row: rowKey,
    ColumnValues: []*hbase.TColumnValue{
        &amp;hbase.TColumnValue{
            Family:    tableCF,
            Qualifier: qualifier,
            Value:     rowValue,
        },
    },
}
err = thriftClient.Put(table, tput)

hbase.HbaseCloseThriftConnection(hbaseThriftTrans)
</code></pre>

<h3 id="python--hbase">python 访问 hbase</h3>

<p>如  ablozhou 在 <a href="http://abloz.com/2012/06/01/python-operating-hbase-thrift-to.html" target="_blank">python通过thrift来操作hbase</a> 所说的: <br />
hbase用java来操作是最方便，也效率最高的方式。但java并非轻量级，不方便在任何环境下调试。而且不同的开发人员熟悉的语言不一样，开发效率也不一样。
hbase 通过thrift，还可以用python,ruby,cpp,perl等语言来操作</p>

<p>python操作的过程也是比较简单，编码时参考 <a href="http://blog.csdn.net/aylazhang/article/details/8563895" target="_blank">php/perl/python , 通过thrift 连接 hbase，进行条件过滤选择</a>，但是，同样的也是遇到了一个问题，</p>

<pre><code>invalid method name: 'scanneropenwithscan'
</code></pre>

<p>thrift server端启动的时候，不要用 thrift2，而是thrift，就没有这个问题了。
而go 访问 hbase的使用要使用的thrift2，目前用的解决办法是在不同的机器上分别启动对应服务。</p>

<h2 id="section-1">其他</h2>

<p>1、python 连接redis使用的密码</p>

<pre><code>redis.Redis(host='localhost', port=6379, db=0, password=None, socket_timeout=None, connection_pool=None, charset='utf-8', errors='strict', unix_socket_path=None)
</code></pre>

<p>使用    <code>password</code> 而不是 <code>auth</code>。</p>

<p>2、hbase shell 清空表中数据</p>

<pre><code>hbase(main)&gt; truncate 't1'
</code></pre>

<p>可多看看 <a href="http://www.cnblogs.com/nexiyi/p/hbase_shell.html" target="_blank">HBase 常用Shell命令</a></p>

<p>3、java访问hbase</p>

<p>花了半天做了尝试，结果没有成功。 BAD！</p>

    </div>
</div>



    
        <div class="comment">
    
    <!-- duoshuo -->
    
    <div class="ds-thread" data-thread-key="/2015/01/20/hbase操作笔记" data-title="Hbase操作笔记" data-url="http://jgj1986.github.io/2015/01/20/hbase%E6%93%8D%E4%BD%9C%E7%AC%94%E8%AE%B0.html"></div>
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-woshifengzi"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    

    
    <!-- disqus -->
    
    
    
</div>

    



                    </div>
                    <div class="col-md-3" id="main-right">
                        <div>
    <h4><strong>文章分类</strong></h4>
    <hr class="small-margin colored-hr" />
    <ul class="side-cat-ul">
        
        <li><a href="/categories.html#cat-生活随记" title="生活随记">生活随记 (3)</a></li>
        
        <li><a href="/categories.html#cat-bigdata" title="bigdata">bigdata (9)</a></li>
        
        <li><a href="/categories.html#cat-web" title="web">web (9)</a></li>
        
        <li><a href="/categories.html#cat-database" title="database">database (3)</a></li>
        
        <li><a href="/categories.html#cat-linux" title="linux">linux (10)</a></li>
        
        <li><a href="/categories.html#cat-go" title="go">go (8)</a></li>
        
        <li><a href="/categories.html#cat-运维" title="运维">运维 (3)</a></li>
        
        <li><a href="/categories.html#cat-language" title="language">language (7)</a></li>
        
        <li><a href="/categories.html#cat-tools" title="tools">tools (1)</a></li>
        
        <li><a href="/categories.html#cat-iot" title="iot">iot (5)</a></li>
        
    </ul>
</div>

<hr class="small-margin colored-hr" />

<!-- google adsense -->
<!--
<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
        style="display:inline-block;width:300px;height:600px"
        data-ad-client="ca-pub-1339945837472110"
        data-ad-slot="8220828081"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
-->


                    </div>
                </div>
            </div>

            <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <hr class="colored-hr" />

                <p class="text-center">
                Copyright 2014 - 2016 | Gen time&#58; 2016-04-12 01:51:47 CST

                <!-- cnzz -->
                

                </p>


            </div>
        </div>
    </div>
    <div style="display:none;" class="back-to" id="toolBackTop">
        <a title="返回顶部" onclick="window.scrollTo(0,0);return false;" href="#top" class="back-top">返回顶部</a>
    </div>

    <!-- google analytics -->
    


</div>

    </body>
</html>
