<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="author" content="jgj" />
        <meta name="viewport" content="width=device-width" /> 
        <title>Lex Yacc 学习笔记 | 我是疯子</title>
        
        <meta name="keywords" content="" />
        

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- bootstrap source -->
        <!-- 新 Bootstrap 核心 CSS 文件 -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <!-- 可选的Bootstrap主题文件（一般不用引入） -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
        <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
        <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
        <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
        <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="/asset/css/kissdata.css" />

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <link href="/feed.html" rel="alternate" title="jgj" type="application/atom+xml" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="icon" href="/favicon.ico" />

        <style type="text/css">
            body {
                padding-top: 55px;
                padding-bottom: 30px;
                background-color: #EEE;
            }
        </style>

        <link rel="stylesheet" href="/asset/js/google-code-prettify/prettify.css">
        <script src="/asset/js/google-code-prettify/prettify.js"></script>

        <script type="text/javascript">
            $(document).ready(function () {

                // go to top
                var bt = $('#toolBackTop'); var sw = $(document.body)[0].clientWidth; var limitsw = (sw - 840) / 2 - 80; if (limitsw > 0){ limitsw = parseInt(limitsw); bt.css("right",limitsw); } $(window).scroll(function() { var st = $(window).scrollTop(); if(st > 30){ bt.show(); }else{ bt.hide(); } });

                // google-code-prettify
                $("pre").addClass("prettyprint linenums"); prettyPrint();

            })
        </script>

        <!-- kp747 
        
        -->
    </head>
    <body>
            <div id="header">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand normal-a" href="javascript:void(0)" onclick="javascript:void(0)">
                    <span id="site_name">我是疯子</span>
                </a>
            </div>

            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/categories.html">分类</a></li>
                    <li><a href="/guestbook.html">留言</a></li>
                    <li><a href="/about.html">关于</a></li>
                    <li><a href="/feed.html">RSS</a></li>
                    <li><a href="javascript:void(0)" class="normal-a" onclick="javascript:void(0)"><span id="site_description">在此停留片刻，偶有所得！</span></a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
</div>


            <div class="container">
                <div class="row">
                    <div class="col-md-9" id="main-left">
                        <div class="page">
    <div class="head">
        <div class="title">Lex Yacc 学习笔记</div>
        <div class="date">date: 2014-12-06</div>
    </div>
    <hr class="middle-margin" />


    <!-- google adsense -->
    <!--
    <div>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:inline-block;width:728px;height:90px"
            data-ad-client="ca-pub-1339945837472110"
            data-ad-slot="9657522081"></ins>
        <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
    </div>
    <hr class="middle-margin" />
    -->

    <div class="content">
        <ul id="markdown-toc">
  <li><a href="#section">简介</a>    <ul>
      <li><a href="#section-1">编译工具</a></li>
    </ul>
  </li>
  <li><a href="#lex">lex</a>    <ul>
      <li><a href="#section-2">框架</a></li>
      <li><a href="#section-3">简单实例1</a></li>
      <li><a href="#section-4">简单实例2</a></li>
    </ul>
  </li>
  <li><a href="#yacc">yacc</a>    <ul>
      <li><a href="#section-5">框架</a></li>
      <li><a href="#section-6">简单实例1</a></li>
    </ul>
  </li>
</ul>

<blockquote>
  <p>项目开始时，要提供sql语句的查询功能，而后台的实现不是常规sql，计划实现个简单的sql功能，于是看到了lex、yacc</p>
</blockquote>

<h2 id="section">简介</h2>

<p>lex/yacc多用于编译器的开发，lex做词法解析，yacc做语法解析。可以看看 <a href="http://dinosaur.compilertools.net/" target="_blank">The LEX &amp; YACC Page</a>
 和 <a href="http://epaperpress.com/lexandyacc/index.html" target="_blank">Lex &amp; Yacc Tutorial</a> 。历史来源、理论等不做过多说明。</p>

<h3 id="section-1">编译工具</h3>
<p>学习过程中，尝试在Linux上使用C语言的工具，lex使用工具 <code>flex</code>， yacc使用工具 <code>bison</code>。假设有文件 frame.l (lex文件) 和frame.y(yacc文件)，大致编译如下</p>

<pre><code>$ flex frame.l  #生成lex.yy.c
$ bison frame.y #生成frame.tab.c和frame.tab.h
$ gcc frame.tab.c lex.yy.c -o start
</code></pre>

<h2 id="lex">lex</h2>

<h3 id="section-2">框架</h3>
<p>lex代码框架形式如下</p>

<pre><code>... 定义  ... 
%%     
... 规则  ... 
%% 
... 子程序  ...
</code></pre>

<p>通过 <code>%%</code> 将lex分为三部分。</p>

<h3 id="section-3">简单实例1</h3>
<p>lex中可以通过正则表达式做匹配（对于正则表达式，此文不描述），结合其框架，我们先实现一个简单的实例，打印 是数字 还是 单词。
本实例来自 <a href="http://blog.csdn.net/djinglan/article/details/9263361" target="_blank">Lex和Yacc入门</a>（其源出处已经404了，此处只好提供一个转发的地址了）</p>

<pre><code>%{
    #include &lt;stdio.h&gt;
%}

%%
[0123456789]+           printf(“NUMBER\n”);
[a-zA-Z][a-zA-Z0-9]*    printf(“word\n”);
</code></pre>

<p>上面定义处引用 <code>stdio.h</code>是为了使用里面的printf函数。注意这儿实现C功能的解析，所以该有 <code>;</code> 的地方还是不能少。假设文件名为 “print.l”，可以用如下命令编译，执行</p>

<pre><code>$ flex print.l
$ gcc lex.yy.c -o print -ll
$ ./print
daa
Word

fadfadfafasddfasdfadsf
Word

234
NUMBER

dfa234
Word 
</code></pre>

<p>-ll表示连接lex的库，在liblex中有main函数，所以上面print.l中没有main函数的情况下，还是可以运行。</p>

<h3 id="section-4">简单实例2</h3>
<p>上面的例子给出一个可以运行的的代码，先建立了使用的信心；<a href="http://epaperpress.com/lexandyacc/prl.html" target="_blank">lex/yacc的epp</a>上提供的一个实例能很好的描述lex的一些内在逻辑，如下：</p>

<pre><code>%{
    int nchar, nword, nline;
%}
%%
\n         { nline++; nchar++; }
[^ \t\n]+  { nword++, nchar += yyleng; }
.          { nchar++; }
%%
int main(void) {
    yylex();
    printf("%d\t%d\t%d\n", nchar, nword, nline);
    return 0;
}
</code></pre>

<p>此处代码使用lex中预定义的变量：</p>

<pre><code>int yylex(void)     调用扫描器,返回标记 
char *yytext        指针,指向所匹配的字符串 
yyleng              所匹配的字符串的长度 
yylval              与标记相对应的值 
int yywrap(void)    约束,如果返回 1 表示扫描完成后程序就结束了,否则返回 0 
FILE *yyout         输出文件 
FILE *yyin          输入文件 
INITIAL             初始化开始环境 
BEGIN               按条件转换开始环境 
ECHO                输出所匹配的字符串
</code></pre>

<h2 id="yacc">yacc</h2>

<h3 id="section-5">框架</h3>
<p>yacc代码框架形式如下</p>

<pre><code>... 定义  ... 
%%     
... 规则  ... 
%% 
... 子程序  ... 
</code></pre>

<p>可以发现，yacc和lex的架构是一样的。YACC可以解析输入流中的标识符(token)，而这些标识符来自lex。</p>

<h3 id="section-6">简单实例1</h3>

<p>假设有lex文件，其内容为：</p>

<pre><code>%{
    #include &lt;stdio.h&gt;
    #include "y.tab.h"
%}

%%
[0-9]+                  return NUMBER;
[a-zA-Z][a-zA-Z0-9]+    return WORD;
%%
</code></pre>

<p>yacc文件中的代码：</p>

<pre><code>%{
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void yyerror(char *s) { 
    printf("%s\n", s); 
}   

int yywrap() {
    return  1;  
}   

int main() {
    yyparse();
    return 0;
}   
%}
%token  NUMBER WORD

%%
commands: /* empty */
    | commands command
    ;

command: target_word
    | target_num
    ;

target_word:
WORD {
    printf("\t yacc get word \n");
}
;

target_num:
NUMBER {
    printf("\tyacc get number\n");
}
;
%%
</code></pre>

<p>编译执行测试：</p>

<pre><code>$ flex frame.l 
$ bison -d y.y 
$ gcc lex.yy.c y.tab.c -o test 
$ ./test
wdafs
    yacc get word 

1234
    yacc get number

dsfad134
    yacc get word 
</code></pre>

<p>lex通过正则匹配得到 <code>NUMBER</code> 和 <code>WORD</code>，在yacc中使用 <code>巴科斯范式</code>得到 NUMBER 和  WORD 并做处理。本实例只是一个非常简单的例子，得到后做一个打印输出，表明我得到了什么。</p>

<p><strong>后续，其他的几个yacc的实例，并对lex和yacc做一总结</strong></p>

    </div>
</div>



    
        <div class="comment">
    
    <!-- duoshuo -->
    
    <div class="ds-thread" data-thread-key="/2014/12/06/lex-yacc-学习笔记" data-title="Lex Yacc 学习笔记" data-url="http://jgj1986.github.io/2014/12/06/lex-yacc-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html"></div>
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"blog-woshifengzi"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.unstable.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
    

    
    <!-- disqus -->
    
    
    
</div>

    



                    </div>
                    <div class="col-md-3" id="main-right">
                        <div>
    <h4><strong>文章分类</strong></h4>
    <hr class="small-margin colored-hr" />
    <ul class="side-cat-ul">
        
        <li><a href="/categories.html#cat-生活随记" title="生活随记">生活随记 (3)</a></li>
        
        <li><a href="/categories.html#cat-bigdata" title="bigdata">bigdata (9)</a></li>
        
        <li><a href="/categories.html#cat-web" title="web">web (9)</a></li>
        
        <li><a href="/categories.html#cat-database" title="database">database (3)</a></li>
        
        <li><a href="/categories.html#cat-linux" title="linux">linux (10)</a></li>
        
        <li><a href="/categories.html#cat-go" title="go">go (8)</a></li>
        
        <li><a href="/categories.html#cat-运维" title="运维">运维 (3)</a></li>
        
        <li><a href="/categories.html#cat-language" title="language">language (7)</a></li>
        
        <li><a href="/categories.html#cat-tools" title="tools">tools (1)</a></li>
        
        <li><a href="/categories.html#cat-iot" title="iot">iot (5)</a></li>
        
    </ul>
</div>

<hr class="small-margin colored-hr" />

<!-- google adsense -->
<!--
<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
        style="display:inline-block;width:300px;height:600px"
        data-ad-client="ca-pub-1339945837472110"
        data-ad-slot="8220828081"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
-->


                    </div>
                </div>
            </div>

            <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <hr class="colored-hr" />

                <p class="text-center">
                Copyright 2014 - 2016 | Gen time&#58; 2016-04-12 01:51:47 CST

                <!-- cnzz -->
                

                </p>


            </div>
        </div>
    </div>
    <div style="display:none;" class="back-to" id="toolBackTop">
        <a title="返回顶部" onclick="window.scrollTo(0,0);return false;" href="#top" class="back-top">返回顶部</a>
    </div>

    <!-- google analytics -->
    


</div>

    </body>
</html>
