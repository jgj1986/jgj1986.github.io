<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="author" content="jgj" />
        <meta name="viewport" content="width=device-width" /> 
        <title>记录生活工作中的点滴 | 我是疯子</title>
        

        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

        <!-- bootstrap source -->
        <!-- 新 Bootstrap 核心 CSS 文件 -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css" />
        <!-- 可选的Bootstrap主题文件（一般不用引入） -->
        <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
        <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
        <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
        <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
        <script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

        <link rel="stylesheet" href="/asset/css/kissdata.css" />

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <link href="/feed.html" rel="alternate" title="jgj" type="application/atom+xml" />
        <link rel="shortcut icon" href="/favicon.ico" />
        <link rel="icon" href="/favicon.ico" />

        <style type="text/css">
            body {
                padding-top: 55px;
                padding-bottom: 30px;
                background-color: #EEE;
            }
        </style>

        <link rel="stylesheet" href="/asset/js/google-code-prettify/prettify.css">
        <script src="/asset/js/google-code-prettify/prettify.js"></script>

        <script type="text/javascript">
            $(document).ready(function () {

                // go to top
                var bt = $('#toolBackTop'); var sw = $(document.body)[0].clientWidth; var limitsw = (sw - 840) / 2 - 80; if (limitsw > 0){ limitsw = parseInt(limitsw); bt.css("right",limitsw); } $(window).scroll(function() { var st = $(window).scrollTop(); if(st > 30){ bt.show(); }else{ bt.hide(); } });

                // google-code-prettify
                $("pre").addClass("prettyprint linenums"); prettyPrint();

            })
        </script>

        <!-- kp747 
        
        -->
    </head>
    <body>
            <div id="header">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand normal-a" href="javascript:void(0)" onclick="javascript:void(0)">
                    <span id="site_name">我是疯子</span>
                </a>
            </div>

            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">首页</a></li>
                    <li><a href="/categories.html">分类</a></li>
                    <li><a href="/guestbook.html">留言</a></li>
                    <li><a href="/about.html">关于</a></li>
                    <li><a href="/feed.html">RSS</a></li>
                    <li><a href="javascript:void(0)" class="normal-a" onclick="javascript:void(0)"><span id="site_description">在此停留片刻，偶有所得！</span></a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
</div>


            <div class="container">
                <div class="row">
                    <div class="col-md-9" id="main-left">
                        <h1>记录生活工作中的点滴</h1>

<hr class="small-margin" />

<div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/12/01/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%80%BB%E7%BB%93.html"><span class="title">Linux系统安装总结</span></a><span class="date">2014-12-01</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#gentoo">推荐学习gentoo</a></li>
  <li><a href="#section">问题1</a>    <ul>
      <li><a href="#windowsu-">Windows上制作u 盘启动盘</a></li>
      <li><a href="#section-1">安装</a></li>
      <li><a href="#windows">再次安装windows的问题</a></li>
      <li><a href="#section-2">安装</a></li>
    </ul>
  </li>
  <li><a href="#section-3">问题2</a></li>
</ul>

<blockquote>
  <p>如果将安装、升级Linux过程中的问题好好记录下，真的会是一个很好的blog，可惜一直以来没有好好的记录，本身又不擅长写东西，那就简单的描述一下过程吧。</p>
</blockquote>

<h2 id="gentoo">推荐学习gentoo</h2>
<p>gentoo官网，<a href="https://www.gentoo.org/" target="_blank">https://www.gentoo.org</a>。
    如果一步步的安装gentoo，从分区到加载网络，到配置make.conf配置文件，安装最基本的包，到编译内核，安装桌面，到配置字体环境、驱动等等，对linux系统会有非常好的了解。</p>

<h2 id="section">问题1</h2>

<p>2013年4月21日，试着安装fedora 18，想来着应该是一个非常容易的操作，没有想到却出现了这么多的问题。</p>

<h3 id="windowsu-">Windows上制作u 盘启动盘</h3>

<p>根据网上的资料，使用了Universal-USB-Installer\ UltraISO，结果不好使，里面设置的内核路径不正确。开始的时候，怀疑因为系统是win8导致的，后来发现有fedora提供的liveusb-creator，这个工具就可以直接制作fedora 的u盘启动盘了</p>

<h3 id="section-1">安装</h3>

<p>fedora 18的分区，我实在没有搞明白是怎么回事。<br />
遇到的问题是，我试着自己去将windows上的F盘给fedora，新建分区那就要删掉就得分区 ！</p>

<p><em>结果windows被干掉了</em></p>

<p>我现在用的一种办法是，进入命令行，使用fdisk命令，将要给linux的那个分区删掉，让fedora自己来识别吧(没有创建分区的空硬盘区间)。</p>

<p>. 为什么不全部给Linux啊，因为蛋疼的要做.net的C#开发<br />
. 那为什么还要用linux啊，因为看到博客说Linux上可以创建 .net的环境，痒痒的非常想在Linux上弄个这样的环境  </p>

<h3 id="windows">再次安装windows的问题</h3>

<p>安装了个windows 7 的系统，发现时32位的，8G的内容只用了不到3G，太浪费了，决定重装。</p>

<p>整个磁盘全部格式化，好好设计一下分区。安装完windows 的时候，最开始的启动，每次都要进入grub，又因为整个磁盘格式化了，没有支持grub了，所以启动不起来了。既然整个磁盘都格式化了，为什么还会有grub呢。尝试重新安装了几次，重复着同样的故事。</p>

<p>想到了两个地方：MBR 里面是不是还是grub，window没有能够写入；之前做计算机等级考试系统安装的时候，也有这样的问题。</p>

<h3 id="section-2">安装</h3>
<p>于是做了两步操作<br />
a、启动进入bios配置，将磁盘的类型做了个更换。我选为ahci，具体是那种会起作用，不确定，因为之前的那次就是在该了个磁盘的类型<br />
b、使用老毛桃的工具，将磁盘重新格式化，在格式化的时候，选择将mbr也格式化  </p>

<p>再次尝试安装win 8， ok了</p>

<h2 id="section-3">问题2</h2>

<p>2013年7月10日，安装foresightLinux，遇到各种各样的问题。</p>

<p>开始使用u盘安装的时候，需要在U盘中有开始iso镜像，安装完以后不能启动，提示</p>

<pre><code>Dropping to debug shell
</code></pre>

<p>去掉启动时的图形界面，查看不识别指定的root，开始使用的是 <code>root=LABEL=/</code>，换成 <code>root=/dev/sda2</code> 之后就可以了</p>

<p>现在grub的配置在 /boot/grub/grub.cnf中了</p>

</div>
        <div class="more text-right"><a href="/2014/12/01/Linux%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%E6%80%BB%E7%BB%93.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/12/01/Linux%E5%B0%8F%E7%9F%A5%E8%AF%86%E4%B9%8B%E9%85%8D%E7%BD%AE.html"><span class="title">Linux小知识之配置</span></a><span class="date">2014-12-01</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#section">显示配置</a></li>
  <li><a href="#section-1">设置音效设备</a></li>
  <li><a href="#section-2">虚拟机重启键冲突</a></li>
  <li><a href="#wireless">wireless无线配置</a></li>
  <li><a href="#vitrualbox">vitrualBox</a></li>
  <li><a href="#section-3">磁盘空间</a></li>
  <li><a href="#vpn">vpn访问</a></li>
  <li><a href="#section-4">防火墙</a></li>
  <li><a href="#ulimit">ulimit</a></li>
  <li><a href="#windows">windows配置</a></li>
</ul>

<h3 id="section">显示配置</h3>
<p>使用xrandr命令可以配置多显示器或单显示器显示，</p>

<p>列出支持的显卡</p>

<pre><code>xrandr
</code></pre>

<p>关闭外接的显卡</p>

<pre><code>xrandr --output VGA1 --off
</code></pre>

<p>两个显卡显示相同的内容，且设置分辨率，为了能在本机显示全</p>

<pre><code>xrandr --output VGA1 --same-as LVDS1 --mode 1024x768
</code></pre>

<p>两个显卡显示不同</p>

<pre><code>xrandr --output LVDS1 --auto --rotate normal --pos 0x0 --output VGA1 --auto --rotate normal --right-of LVDS1
</code></pre>

<p>详细参看 <a href="https://wiki.archlinux.org/index.php/xrandr" target="_blank">xrandr in ArchWiki</a></p>

<p>*
在安装ubunut14.04版本是遇到显示的问题，某个字显示时好时坏，还偶尔会有花屏的问题。</p>

<pre><code>$ cat /etc/modprobe.d/radeon-kms.conf 
options radeon modeset=0  
</code></pre>

<h3 id="section-1">设置音效设备</h3>

<p>安装arch，使用openbox，然后什么外部设备的界面控制也没有装（机器比较挫，为了节省资源，其实也没有节省多少，尽折腾了）
对于音响，没有图形界面控制，就使用了 <code>aumix</code> 命令</p>

<pre><code>aumix -v 85 -q  
aumix -v +10 q 
</code></pre>

<p>上面命令的说明</p>

<p>-q 　显示所有频道的设置值。
 -v 　主音量。</p>

<p>更多的用 <code>man</code> 看下</p>

<h3 id="section-2">虚拟机重启键冲突</h3>

<p>虚拟机上使用 <code>ctrl+alt+del</code> 与host的键冲突，这个时候，使用键盘右边的 <code>ctrl+alt</code></p>

<h3 id="wireless">wireless无线配置</h3>

<pre><code>wpa_pass* essid passworld &gt; /etc/wpa_supplicant.conf
wpa_supplicant -B -Dwext -i wlan0 -c /etc/wpa_supplicant.conf
iwconfig wlan0 essid XXXX
dhcpcd wlan0
</code></pre>

<p>使用rtl8192SE的无线网卡时，当把驱动编译的到内核的时候，不能使用，而编译为模块就好用了。参考 <a href="https://wiki.archlinux.org/index.php/Wireless" target="_blank">wireless in ArchWiki</a></p>

<h3 id="vitrualbox">vitrualBox</h3>

<p>早上来到，VB每次启动都有问题，说是在libQtCoreVitrul.so.0的某个地方有段错误，
直接重新安装VB也不起作用，将/opt/VitrualBox/文件删掉，然后重新安装，有了新的问题</p>

<p>. 显示启动不了 – 将显卡的内存调大<br />
. 然后有权限问题 – 将/opt/ 整个目录都改成root的  <br />
. 还是不行 – chmod 755 /opt/VirtualBox/VirtualBox<br />
. 仍旧不可以(提示让重新安装) – 重新安装  </p>

<p>总结，/opt下的内容要有适合的用户名和用户权限</p>

<h3 id="section-3">磁盘空间</h3>

<p>删除一些文件后，磁盘空间还是满的，因为那些文件都还在打开的状态被你删除了，虽然你在硬盘上删除了文件，但是系统还认为这些文件还存在，你可以
<code>lsof |grep delete</code>看看，应该有很多你之前删除，但是还被系统打开的文件，找到相应的id，kill之。</p>

<p>如果进程不能kill， <code>echo &gt; /proc/pid/fd/对应的文件</code></p>

<p>参考<a href="http://zhumeng8337797.blog.163.com/blog/static/100768914201121125649849/" target="_blank">为什么删除文件后磁盘空间还是不变</a>。</p>

<h3 id="vpn">vpn访问</h3>

<pre><code>pptpsetup -create vpn -server VPN-SERVER-IP -username 用户名 -password 密码 -encrypt -start
/sbin/route add -net 0.0.0.0 dev ppp0
</code></pre>

<p>上面的命令就好使了，如果想了解更多，可以参考 <a href="https://wiki.archlinux.org/index.php/PPTP_VPN_client_setup_with_pptpclient" target="_blank">PPTP VPN Client in ArchWiki</a>。</p>

<h3 id="section-4">防火墙</h3>

<p>redhat系列的发行版，默认都有防火墙，在配置samba、nginx等的时候，要注意，不然会浪费比较长的时间。</p>

<h3 id="ulimit">ulimit</h3>

<pre><code>sudo vim /etc/security/limits.conf
## 设置root帐户
## nofile 表示文件句柄数的设置
## soft即是软限制，hard是硬限制。用户可以超过soft设置的值，但一定不能超过hard 的值。一般soft比hard小
root soft nofile 65536
root hard nofile 65536
## 设置work帐户
work soft nofile 65536
work hard nofile 65536
</code></pre>

<p>这样设置之后，退出重新登录即生效。
 若想对work帐户的nofile再做更进一步的设置，可在 ~/.bashrc 文件下添加一行，如 <code>ulimit -n 51200</code>, 即设置文件句柄数限制为51200。
 注意，在 ~/.bashrc 中的数值不可超过 hard 所设置的值。</p>

<p>曾经遇到问题，修改就是不生效，而且修改了 /etc/sysctl中的file-max。后来发现在 /etc/profile中也做了限制！</p>

<h3 id="windows">windows配置</h3>
<p>使用qemu启动一个windows的虚拟机</p>

<pre><code>sudo qemu-kvm -hda xp.qcow2 -boot c -smp 2 -m 512  -display vnc=0.0.0.0:11
</code></pre>

<p>一些博客中提到，如果不想使用图形界面，启动linux的时候，可以使用串口，将启动的信息都展示出来，而且允许在串口登陆。
但是windows呢，windows必须要有图形界面，这个时候就可以使用vnc的展示方式来访问了。  </p>

<p>如果已经配置了windows的用户名和密码，又想不输入密码直接登录，可以如下配置：</p>

<p>Win-XP:</p>

<p>单击“开始/运行”，输入“rundll32 netplwiz.dll,UsersRunDll”，按回车键后弹出“用户帐户”窗口，看清楚，这可跟“控制面板”中打开的“用户账户”面板窗口不同哦！然后取消选定“要
使用本机，用户必须输入用户名和密码”选项，单击确定，在弹出的对话框中输入你想让电脑每次自动登录的账户和密码即可。</p>

<p>参考：<a href="http://jjxzjz.blog.163.com/blog/static/349259452008238178138" target=":_blank">开机自动登录桌面</a></p>

</div>
        <div class="more text-right"><a href="/2014/12/01/Linux%E5%B0%8F%E7%9F%A5%E8%AF%86%E4%B9%8B%E9%85%8D%E7%BD%AE.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/28/nginx%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0.html"><span class="title">Nginx使用笔记</span></a><span class="date">2014-11-28</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#section">身份验证</a></li>
</ul>

<blockquote>
  <p>本文记录在nginx使用过程中的点滴。</p>
</blockquote>

<h3 id="section">身份验证</h3>

<p><a href="http://blog.sina.com.cn/s/blog_6d579ff401010gp3.html" target="_blank">Nginx 配置指令的执行顺序</a>介绍到nginx的处理请求的过程一共划分为 11 个阶段，依次是：
post-read、server-rewrite、find-config、rewrite、post-rewrite、preaccess、access、post-access、try-files、content 以及 log，而最重要的是rewrite,access和content。
所以我们可以在access阶段做验证操作，相关的逻辑处理放到content中实现。</p>

<p>配置</p>

<pre><code>server {
    access_by_lua_file /path/to/access_ctrl.lua;

    location = /test {
        content_by_lua_file /path/to/test.lua;
    }
}
</code></pre>

<p>access_trl.lua中的实现样式</p>

<pre><code>local req_headers = ngx.req.get_headers()

local key = req_headers["key"]
if nil == key or "TEST" ~= key then
    ngx.exit(600)  -- 验证没有通过的状态码
end

return
</code></pre>

</div>
        <div class="more text-right"><a href="/2014/11/28/nginx%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/28/lua-ngx%E6%93%8D%E4%BD%9CMySQL.html"><span class="title">Lua Ngx操作mysql</span></a><span class="date">2014-11-28</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#mysql">MySQL查询操作</a></li>
  <li><a href="#mysql-1">MySQL的事务操作</a></li>
  <li><a href="#section">编码问题</a></li>
</ul>

<blockquote>
  <p>本文是参考 <a href="https://github.com/openresty/lua-resty-mysql">openresty对MySQL的操作文档</a>，对mysql做添加、查询操作，因业务的需要，使用MySQL的事务操作，并做测试，可以很好的支持。</p>
</blockquote>

<h3 id="mysql">MySQL查询操作</h3>

<p>clone下来lua-resty-mysql的仓库 <code>https://github.com/openresty/lua-resty-mysql.git</code>，在nginx配置中lua路径中包含mysql.lua；或者将mysql.lua放在统一的路径下。可参考文冠的博客<a href="http://blog.kissdata.com/2014/11/14/nginx-lua-install.html" target="_blank">nginx与lua安装教程</a>。
在实际操作时，发现很多的查询都具有相同的特性，于是封装了一个函数，放在nginx的初始化文件中，如下：</p>

<pre><code>function fetch_db_data(sql, limit)
local mysql = require "mysql"
local db, err = mysql:new()
if not db then
    monitor(id, "ERROR", "FAILED_INIT_MYSQL", "")  -- 监控函数，用于告警
    ngx.exit("700")
end
db:set_timeout(1000) -- 1 sec
local ok, err, errno, sqlstate = db:connect {
    host = "127.0.0.1", port = 3306,
    database = "mjyun", user = "root",
    password = "xxxxx",
    max_packet_size = 1024 * 1024 }

if not ok then
    monitor(id, "ERROR", "FAILED_CONNECT_MYSQL", "")
    ngx.exit("701")
end

--fetch data--
if 0 == limit or "" == limit then
    data, err, errno, sqlstate = db:query(sql)
else
    data, err, errno, sqlstate = db:query(sql, limit)
end

local ok, err_1 = db:set_keepalive(10000, 100)
if not ok then
    ngx.log(ngx.ERR, "failed to set keepalive: " )
end
return data, err, errno, sqlstate
end
</code></pre>

<p>当需要查询时，拼接出sql语句直接调用该函数，如：</p>

<pre><code>version_sql = "select version from app_kv_ver where appid = \'" .. id .."\'"
version, err, errno, sqlstate = fetch_db_data(version_sql, 1)
</code></pre>

<p>注意，如果id直接是接口传递的参数，这样就有sql注入的危险，需要对id做验证或其他防范措施。关于sql注入攻击详情，可参考前面的博客 <a href="http://blog.woshifengzi.com/2014/11/11/%E7%BD%91%E7%BB%9C%E6%94%BB%E5%87%BB%E4%B8%8E%E9%98%B2%E8%8C%83.html" target="_blank">网络攻击与防范</a>。</p>

<p>因为<a href="https://github.com/openresty/lua-resty-mysql">github</a>上已经有比较详细的介绍，此过程中用户的函数或方法就不在做过多的介绍。</p>

<h3 id="mysql-1">MySQL的事务操作</h3>

<p>项目中有这样的需求：用户请求更新自己应用的某个key值，且更新这个应用的版本号，这个过程要保证更新的原子性。如此计划采用<a href="http://dev.mysql.com/doc/refman/5.0/en/commit.html" target="_blank">mysql的事务操作</a>。</p>

<pre><code>START TRANSACTION [WITH CONSISTENT SNAPSHOT]
BEGIN [WORK]
COMMIT [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
ROLLBACK [WORK] [AND [NO] CHAIN] [[NO] RELEASE]
SET autocommit = {0 | 1}
</code></pre>

<p>在lua-resty-mysql的例子有，<code>db.query()</code>可以一次执行多条sql语句，于是做了如下的测试：</p>

<pre><code>transaction_sql = "START TRANSACTION;"
insert_kv_sql = "insert into app_kv (appid, app_key, app_val) values (\'mj_test\', \'key1\', \'value1\') ON duplicate KEY UPDATE app_val = \'value2\';"
insert_ver_sql = "insert into app_kv_ver(appid, version) values(\'mj_test\', 0) ON duplicate KEY UPDATE version = version + 1;"
commit_sql = "COMMIT;"

kv_data, err, errno, sqlstate = fetch_db_data(transaction_sql .. insert_kv_sql .. insert_ver_sql .. commit_sql, 4)
</code></pre>

<p>如果将 <code>insert_kv_sql</code> 或 <code>insert_ver_sql</code> 故意改错，则整个过程都不成功，可以达到目的。 :)</p>

<h3 id="section">编码问题</h3>

<p>如果MySQL中存有汉字，查询时会有乱码，操作网上的讨论 <a href="https://github.com/openresty/lua-resty-mysql/issues/20" target="_blank">issues-20</a>，将MySQL服务端的编码改为utf-8。</p>

<pre><code>$ cat my.conf
[mysqld]
skip-character-set-client-handshake
collation-server=utf8_unicode_ci
character-set-server=utf8
</code></pre>

</div>
        <div class="more text-right"><a href="/2014/11/28/lua-ngx%E6%93%8D%E4%BD%9CMySQL.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/25/mongodb%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8.html"><span class="title">Mongodb使用入门</span></a><span class="date">2014-11-25</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#section">建库、建表</a></li>
  <li><a href="#section-1">删除库、表</a></li>
  <li><a href="#section-2">列出库表</a></li>
</ul>

<blockquote>
  <p>不得不说，mongodb的用法和现在常见mysql等还是有些差别的，此文主要列出自己在刚开始接触mongodb时，一些不熟悉的用法。</p>
</blockquote>

<p>mongodb中没有表的概念，而是称作数据集(Collection)，为了自己理解方便，仍然用数据集来代指表。
db.createCollection(name,{size:3333,capped:333,max:88888})  创建一个数据集，相当于一个表</p>

<h3 id="section">建库、建表</h3>

<p>建设要创建数据库 jgj_db，在改库上创建表 jgj_table:</p>

<pre><code>use jgj_db
db.jgj_table.insert({'xx':'xx','xxx':'xxx'})
db.createCollection('jgj_table1',{})   #也是创建表
</code></pre>

<p>上面执行use jgj_db，则就创建了数据库，如果没有后面的操作，在退出后，这个数据库就被删除了。同样，创建数据表，直接用db.table_name.insert向数据表中添加数据就生成了。</p>

<p>因为mongodb中直接存放bson格式的数据，所以表的格式就不需要先创建了。
可能有疑问了，如果插入的bson的格式也不一致，是否可以了，答： 可以！</p>

<h3 id="section-1">删除库、表</h3>

<pre><code>use jgj_db
db.dropDatabase();   删除数据库  
   
db.jgj_table.drop();  删除数据表
</code></pre>

<h3 id="section-2">列出库表</h3>

<pre><code>show dbs;     查看现在已有哪些库
use jgj_db;
show  collections;  查看该库下有哪些表
</code></pre>

</div>
        <div class="more text-right"><a href="/2014/11/25/mongodb%E4%BD%BF%E7%94%A8%E5%85%A5%E9%97%A8.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/25/beego%E4%BD%BF%E7%94%A8%E5%AD%A6%E4%B9%A0.html"><span class="title">Beego使用学习</span></a><span class="date">2014-11-25</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#section">环境</a></li>
  <li><a href="#section-1">创建</a></li>
  <li><a href="#json">json输出</a></li>
  <li><a href="#section-2">路由</a></li>
  <li><a href="#section-3">性能</a></li>
  <li><a href="#revel">Revel</a></li>
</ul>
<p>beego学习</p>

<blockquote>
  <p>技术真是学不完啊，这两天用go语言编程，使用beego框架，感觉还是蛮好用的。<a href="http://beego.me/" target="_blank">beego官网</a>上有比较详细的介绍说明，这里只是将使用过程记录下。</p>
</blockquote>

<h3 id="section">环境</h3>

<p>首先，认为是已经安装好了go的编译环境（可参考<a href="https://golang.org/doc/install" target="_blank">安装</a>、<a href="https://golang.org/doc/code.html" target="_blank">设置环境变量GOPATH</a>），简单过程如下：</p>

<pre><code>$ wget https://storage.googleapis.com/golang/go1.3.3.linux-amd64.tar.gz
$ tar go1.3.3.linux-amd64.tar.gz
$ export GOROOT=/path/to/go
$ export GOPATH=/path/for/go/workspace
$ export PATH=$PATH:$GOROOT/bin:$GOPATH/bin
$ go version
go version go1.3.3 linux/amd64
</code></pre>

<p>然后下载运行beego所需的相关库和工具</p>

<pre><code>$ go get github.com/astaxie/beego   # beego会下载安装到$GOPATH的目录下
$ go get github.com/beego/bee       # 会在$GOPATH/bin目录下生成bee
</code></pre>

<p>bee 工具是一个为了协助快速开发 beego 项目而创建的项目，参考 <a href="http://beego.me/docs/install/bee.md" target="_blank">bee 工具简介</a>了解更多！</p>

<h3 id="section-1">创建</h3>

<p>直接使用bee工具来快速创建一个新项目(如 Fengzi)；可使用bee工具命令参数编译运行项目</p>

<pre><code>$ cd $GOPATH/src
$ bee new Fengzi    # 新建项目
$ cd Fengzi
$ bee run                       # 该命令会编译出可执行文件 Fengzi，并运行
</code></pre>

<p>默认的项目使用8080端口，访问url <code>http://ip:8080</code> 即可访问这个简单的例子。</p>

<h3 id="json">json输出</h3>

<p>beego的架构采用mvc模式，上面创建的简单项目中有models，views和controllers。main.go通过router调用controllers中的业务，由views显示。 <br />
而在自己的业务中，不需要复杂的页面展示，只需要以json格式提供返回数据即可。</p>

<pre><code>func (c *MainController) Get() {
    c.Data["json"] = map[string]string{"ObjectId": "aaa"}
    c.ServeJson()
}
</code></pre>

<p>上面代码中填充对象 <code>Data["json"]</code> 的内容，然后通过 c.ServeJson 返回。在测试时发现，beego更底层使用了Output来做输出：</p>

<pre><code>func (c *MainController) Get() {
    c.Ctx.Output.SetStatus(202)
    c.Ctx.Output.Body([]byte("yes!!"))
}
</code></pre>

<p>这么修改controllers/default.go之后，可在访问下接口，看看得到的结果。</p>

<p>beego中 支持多种格式的输出，JSON、XML、JSONP，例如使用xml格式输出，代码如下：</p>

<pre><code>this.Data["xml"]=&amp;mystruct
this.ServeXml()
</code></pre>

<h3 id="section-2">路由</h3>

<p>应用中的大多数路由都会定义在 routers/router.go，现在新的版本识别 RESTful 格式的url，除了一些基础的路由，现在支持自定义规则以及正则表达</p>

<pre><code>beego.Router("/api/list",&amp;RestController{},"*:ListFood")
beego.Router("/api/create",&amp;RestController{},"post:CreateFood")
beego.Router("/api/update",&amp;RestController{},"put:UpdateFood")
beego.Router("/api/delete",&amp;RestController{},"delete:DeleteFood")   
</code></pre>

<h3 id="section-3">性能</h3>

<p>beego支持的并发访问量能有多大呢？写了一个简单的接收功能接口，用 ab 压测，单进程，能接近2万，算是比较好了。</p>

<h3 id="revel">Revel</h3>
<p>无意中看到一篇关于  <a href="http://neue.v2ex.com/t/89374" target="_blank">Revel和Beego的论战</a>，了解到还有 Revel这个工具，看了下<a href="http://www.gorevel.cn/" target="_blank">他的中文社区</a>，感觉用起来也是蛮方便的。</p>

</div>
        <div class="more text-right"><a href="/2014/11/25/beego%E4%BD%BF%E7%94%A8%E5%AD%A6%E4%B9%A0.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/24/%E4%B8%8E%E8%9A%8A%E5%AD%90%E7%9A%84%E6%96%97%E4%BA%89.html"><span class="title">什么也不能阻止睡觉</span></a><span class="date">2014-11-24</span></div>
        <div class="content"><p>11月24日凌晨2点左右的时候，梦见写的代码运行很顺利，过了一会再运行，就出现问题，返回了不正确的数值。这就比较奇怪了，开始好好，怎么就不能正确返回呢。</p>

<p>奇怪的时候就着急了，然后觉得身上比较痒。在这半睡半醒之际，痒就只能挠了，结果越挠越痒。开始还只是一个地方痒，慢慢的身上很多地方都痒起来了。</p>

<p>这时候总算是清醒些了，晓得不能在挠了，不然就睡不好了，于是暗示自己练气功，走身上的奇经八脉，将痒的东西在食指上排除来（好像自己会六脉神剑）。
终于，比较严重的一波痒的感觉过去了，可是身上其他地方就痒起来了，那就继续暗示自己。。。折腾来折腾去，十个手指头都尝试遍了，还是难以入睡。</p>

<p>就在这个时候，突然感觉到有个小东西撞了下胳膊上的寒毛，顿时十二分的精神。开灯、查床，发现一个肥胖肥胖的蚊子在慢慢的蠕动，都已经爬不动了，只能蠕动了。</p>

<p>想想也就在大半个小时前，她是多么曼妙的身材，转眼间就肥了几十圈。要是我不知道，说不准就一直喝血，自爆了。哎，既然这么不珍惜自己，我就成全了吧。</p>

<p>然后，满手自己的鲜血，毅然决然的入睡。</p>

</div>
        <div class="more text-right"><a href="/2014/11/24/%E4%B8%8E%E8%9A%8A%E5%AD%90%E7%9A%84%E6%96%97%E4%BA%89.html">继续阅读全文</a></div>
    </div>
    
    <div class="post-card">
        <div class="head"><a href="/2014/11/21/Web%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8A%80%E6%9C%AF.html"><span class="title">Web系统使用的技术</span></a><span class="date">2014-11-21</span></div>
        <div class="content"><ul id="markdown-toc">
  <li><a href="#nginxlua">nginx+lua</a></li>
  <li><a href="#tornado">Tornado</a></li>
  <li><a href="#docker">Docker</a></li>
</ul>

<p>Web系统使用的技术</p>

<p>最近要上线一套baas的系统，涉及到一些以前没有使用的技术，在此列下</p>

<h2 id="nginxlua">nginx+lua</h2>

<p>在以前公司的时候，有一部门使用nginx+lua，当时只是听过一些技术分享。现在终于使用了，本人前面有篇博客介绍了使用nginx和lua。
  在此过程，为了有个对nginx的使用情况有个了解，浏览了一遍张宴的《<a href="http://product.dangdang.com/20807089.html?ref=search-0-A" target="_blank">实战nginx，取代Apache的高性能web服务</a>》。
  后面为了解nginx的流程，浏览了章宜春的相关博客， <a href="http://blog.sina.com.cn/s/articlelist_1834459124_0_1.html" target="_blank">Nginx配置指令的执行顺序呢</a>，算是有个了解。
  而在使用过程中，很多的一线资料还是来<a href="https://github.com/openresty/lua-nginx-module" target="_blank">自lua_nginx_module的git库</a></p>

<h2 id="tornado">Tornado</h2>

<p>有人习惯使用python，那这么个流行的语言也就应该有个对应的服务，于是就牵扯到了<a href="http://www.tornadoweb.org/en/stable/" target="_blank">Tornado</a>。网上说的性能情况比较理想，但是使用 <code>apache ab</code> 测试时，启动单实例，每秒的处理数不超过1千。原因还在努力研究中，后续跟进！ :)</p>

<h2 id="docker">Docker</h2>

<p>这是个比较新的东西，其<a href="http://www.dockerpool.com/" target="_blank">中文站点</a>上值得好好看看。内容后续跟进！</p>

</div>
        <div class="more text-right"><a href="/2014/11/21/Web%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8%E7%9A%84%E6%8A%80%E6%9C%AF.html">继续阅读全文</a></div>
    </div>
    
</div>

<div class="nav-post-links">
        
        <span class="newer-posts-link">
            
                <a href="/page5" title="previous page">&laquo; Newer Posts</a>
            
        </span>
        

        
        <span class="older-posts-link">
            <a href="/page7" title="next page">Older Posts &raquo;</a>
        </span>
        
</div>

                    </div>
                    <div class="col-md-3" id="main-right">
                        <div>
    <h4><strong>文章分类</strong></h4>
    <hr class="small-margin colored-hr" />
    <ul class="side-cat-ul">
        
        <li><a href="/categories.html#cat-生活随记" title="生活随记">生活随记 (3)</a></li>
        
        <li><a href="/categories.html#cat-bigdata" title="bigdata">bigdata (9)</a></li>
        
        <li><a href="/categories.html#cat-web" title="web">web (9)</a></li>
        
        <li><a href="/categories.html#cat-database" title="database">database (3)</a></li>
        
        <li><a href="/categories.html#cat-linux" title="linux">linux (10)</a></li>
        
        <li><a href="/categories.html#cat-go" title="go">go (8)</a></li>
        
        <li><a href="/categories.html#cat-运维" title="运维">运维 (3)</a></li>
        
        <li><a href="/categories.html#cat-language" title="language">language (7)</a></li>
        
        <li><a href="/categories.html#cat-tools" title="tools">tools (1)</a></li>
        
        <li><a href="/categories.html#cat-iot" title="iot">iot (5)</a></li>
        
    </ul>
</div>

<hr class="small-margin colored-hr" />

<!-- google adsense -->
<!--
<div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <ins class="adsbygoogle"
        style="display:inline-block;width:300px;height:600px"
        data-ad-client="ca-pub-1339945837472110"
        data-ad-slot="8220828081"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
-->


                    </div>
                </div>
            </div>

            <div id="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <hr class="colored-hr" />

                <p class="text-center">
                Copyright 2014 - 2016 | Gen time&#58; 2016-04-12 01:51:47 CST

                <!-- cnzz -->
                

                </p>


            </div>
        </div>
    </div>
    <div style="display:none;" class="back-to" id="toolBackTop">
        <a title="返回顶部" onclick="window.scrollTo(0,0);return false;" href="#top" class="back-top">返回顶部</a>
    </div>

    <!-- google analytics -->
    


</div>

    </body>
</html>
