---
title:  hbase操作笔记
date: 2015-01-20 18:12:28 +0800
tags: bigdata
- a
- b
---

* toc 
{:toc}

> 本文记录从1月13号到1月20号这接近一周时间内一些工作以及遇到的问题，涉及hbase环境的搭建，到 go 语言使用 thrift 操作 hbase，python访问hbase，以及一些琐碎的知识点。

## hbase环境搭建

要开发就要有测试，要测试就要有测试环境。先搭建个 hbase 的环境，没有想到单单一个 standalone 的环境就用了 NN 久的时间。

### standalone

    $ tar xzf hbase-0.94.26-bin.tar.gz
    $ ln -s hbase-0.94.26 default
    $ cat default/conf/hbase-site.xml
    <configuration>
    <property>
        <name>hbase.rootdir</name>
        <value>file:///data/hbase</value>
    </property>
    <property>
        <name>hbase.zookeeper.property.dataDir</name>
        <value>/data/zookeeper</value>
    </property>
    </configuration>
    $ ./default/bin/start-hbase.sh
    starting master, logging to /home/hbase/default/bin/../logs/hbase-master-ubuntu.out
    $ ps ax | grep hbase
    // 进程没有了   

根据网上的说明，修改 /etc/host

    127.0.0.1   localhost
    127.0.0.1   ubuntu
    
重新执行 `start-hbase.sh` 仍然没有启动。
而如果换成用 root   权限或 sudo 来执行，就好了

    $ sudo ./start-hbase.sh 
    
### 集群

standalone只是一个初始，集群环境才是我们想要的。这个网上的资料就很多了，还有点需要注意 hdfs 和 hbase 的版本兼容没有问题。  
以后使用多了，当整理一篇关于hbase配置的文章。我在安装时，应为 zookeeper 的配置问题，浪费了一些时间。是这样的：
zoo.cfg 中定义zookeeper集群的 多个node，以及 dataLogDir，那就需要在 `dataLogDir` 目录下建一个 myid 文件，文件的内容为 zoo.cfg 对应的server.id中的id

关于hbase，参考 [官方文档](http://hbase.apache.org/book.html#quickstart){:target="_blank"} 或  [中文版](http://abloz.com/hbase/book.html){:target="_blank"}，
而但就安装而言，我觉得博客 [Hbase安装配置（含分布式ZooKeeper）](http://linuxjcq.blog.51cto.com/3042600/760634/){:target="_blank"}是比较清晰的。


## 访问hbase 的操作

### go 访问 hbase

这个项目是使用hbase来存放要查询的设备id，而为了达到实时计算的目的，使用 heka  插件了进行，为此使用 go 通过 thrift 来操作 hbase。
文冠的博客 [golang通过thrift操作Hbase](http://blog.kissdata.com/2014/08/04/golang-thrift-hbase.html){:target="_blank"}就是做这个介绍的。
其实得到的结果是，thrift上和hbase集群使用了相同的配置，启动后就能直接访问hbase了。
这样，在实际的操作过程中，就是thrift的接口。

    $ ./hbase thrift2 -p 9090 start
    
列举go 访问hbase 的几个关键代码点

    import  git.apache.org/thrift.git/lib/go/thrift
    
    hbaseThriftTrans, hbaseThriftClient, err := hbase.HbaseOpenThriftConnection(mj.hbaseHost, mj.hbasePort);
    
    tput := &hbase.TPut{
        Row: rowKey,
        ColumnValues: []*hbase.TColumnValue{
            &hbase.TColumnValue{
                Family:    tableCF,
                Qualifier: qualifier,
                Value:     rowValue,
            },
        },
    }
    err = thriftClient.Put(table, tput)
    
    hbase.HbaseCloseThriftConnection(hbaseThriftTrans)

    
### python 访问 hbase

如  ablozhou 在 [python通过thrift来操作hbase](http://abloz.com/2012/06/01/python-operating-hbase-thrift-to.html){:target="_blank"} 所说的:   
hbase用java来操作是最方便，也效率最高的方式。但java并非轻量级，不方便在任何环境下调试。而且不同的开发人员熟悉的语言不一样，开发效率也不一样。
hbase 通过thrift，还可以用python,ruby,cpp,perl等语言来操作

python操作的过程也是比较简单，编码时参考 [php/perl/python , 通过thrift 连接 hbase，进行条件过滤选择](http://blog.csdn.net/aylazhang/article/details/8563895){:target="_blank"}，但是，同样的也是遇到了一个问题，

    invalid method name: 'scanneropenwithscan'
    
thrift server端启动的时候，不要用 thrift2，而是thrift，就没有这个问题了。
而go 访问 hbase的使用要使用的thrift2，目前用的解决办法是在不同的机器上分别启动对应服务。


## 其他

1、python 连接redis使用的密码

    redis.Redis(host='localhost', port=6379, db=0, password=None, socket_timeout=None, connection_pool=None, charset='utf-8', errors='strict', unix_socket_path=None)
    
使用    `password` 而不是 `auth`。

2、hbase shell 清空表中数据

    hbase(main)> truncate 't1'
    
可多看看 [HBase 常用Shell命令](http://www.cnblogs.com/nexiyi/p/hbase_shell.html){:target="_blank"}

3、java访问hbase

花了半天做了尝试，结果没有成功。 BAD！
