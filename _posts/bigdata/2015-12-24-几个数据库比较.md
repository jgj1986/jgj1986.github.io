---
title:  几种存储DB的对比
date: 2015-12-24 12:12:28 +0800
tags: bigdata
- a
- b
---

* toc
{:toc}

> 在统计的实现过程中用到了Redis、LevelDB 和 SSDB，对这三者，有必要好好的统计分析下

## 资源占用

Redis 是要一直存在内存中的，当然如果有必要，也可flush回磁盘，需要的时候在download进内存，但是过程比较长，而且不是redis的正道。
相对而言leveldb和ssdb就是将数据存储在磁盘上，需要时才会将需要的部分load进内存中，所以对内存的要求比较低。

## 速度

Redis的资源都在内存中，请求的相依速度会比较快。每次请求方式都是以网络形式进行，会带来一定的时间消耗。
leveldb和ssdb的读写都是磁盘的上的操作，相比redis，速度肯定会降低一些。

## 实际使用

在实际的统计分析时，当数据量比较大的时候，且Redis的交互比较频繁的时候，发现Redis的读写请求也成了性能瓶颈，完全没有达到预期。
为此，采用新leveldb存储的方式，在统计时，将数据完全load到内存中，在进行读写操作（包括判断）时，直接和内存进行交互，从而大大提高了速度。
但是这样有一个问题，就是随着时间的推移，保留的历史数据会越来越多，需要的内存就会越来越大。
在此过程中还有个问题，如果程序被非法中断，可能会导致leveldb数据的破坏，导致下次load会失败。

后续了解到，在BI的reduce过程中，使用ssdb做判断（因为集群能力还是有限，将一些计算从Hive前移到MR中）。
这儿通过一些措施来减少ssdb可能带来的影响：1.根据日志的类型ssdb做了不同的库；2.map过程将同样的key整合在了一起，减少ssdb的交互次数。

## rocksdb

redis、leveldb已经比较多的使用到很多地方了，从[官网](http://ssdb.io/){:target="_blank"}上了解到ssdb也已经在很多公司中使用了。
现在能搜到Facebook开源的RocksDB，说是更加彪悍，通过下面的一个[性能比较](https://influxdb.com/blog/2014/06/20/leveldb_vs_rocksdb_vs_hyperleveldb_vs_lmdb_performance.html){:target="_blank"}，发现还是各有千秋，rocksdb在读写删除等上确实是快了一些。。

## 资料

[ssdb 中文文档](http://ssdb.io/docs/zh_cn/){:target="_blank"};  
[leveldb/rocksdb/HyperLevelDB/LMDB性能对比](https://influxdb.com/blog/2014/06/20/leveldb_vs_rocksdb_vs_hyperleveldb_vs_lmdb_performance.html){:target="_blank"};


