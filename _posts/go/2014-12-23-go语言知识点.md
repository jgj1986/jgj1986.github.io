---
title:  go语言知识点
date: 2014-12-23 17:12:28 +0800
tags: go
- a
- b
---

* toc 
{:toc}

### 时间格式化

go语言提供的时间接口还是很丰富的，但是对显示时间格式化操作时，必须用 `2006-01-02 15:04:05`，这让人比较纠结

    fmt.Println(timeNow.Format("2006-01-02T15:04:05.999Z+08:00"))
    fmt.Println(time.Now().Format("2006-01-02 15:04:05"))

[golang文档](http://golang.org/pkg/time/){:target="_blank"}中描述，如

    Mon Jan 2 15:04:05 MST 2006
    01/02 03:04:05PM 06 -0700
    
想起了 庄晓立(Liigo)的[我为什么放弃Go语言](http://blog.csdn.net/liigo/article/details/23699459){:target="_blank"}，确实还是有比较多的限制。

在使用时间做转换的时候，都会遇到时区的问题，比如

    the_time, _ := time.Parse("2006-01-02T15:04:05", "2015-06-16T15:19:41")
    fmt.Println("%d", the_time.Unix())

返回结果为 `1434467981`，将这个结果转为对应的年月日时分秒 

    $ date -d "@1434467981"
    Tue Jun 16 23:19:41 CST 2015
    
多了八个小时，这就是时区带来的问题。可在解析的时候指定时区，如下：
    
    loc, _ := time.LoadLocation("Local")
    // loc, _ := time.LoadLocation("Asia/Shanghai")
    the_time, _ := time.ParseInLocation("2006-01-02T15:04:05", "2015-06-16T15:19:41",loc)
    fmt.Println("%d", the_time.Unix())

这个时候的返回结果为 `1434439181`，就合适了。注意，这儿使用的是函数 `ParseInLocation`。

### vim中go语法高亮显示

参考 [vim中go的语法高亮设置](http://www.tuicool.com/articles/nmqaMbq){:target="_blank"}。过程如下

    sudo cp -r $GOROOT/misc/vim/indent/* /usr/share/vim/vimcurrent/indent
    sudo cp -r $GOROOT/misc/vim/syntax/* /usr/share/vim/vimcurrent/syntax
    sudo cp -r $GOROOT/misc/vim/compiler/* /usr/share/vim/vimcurrent/compiler
    sudo cp -r $GOROOT/misc/vim/ftplugin/* /usr/share/vim/vimcurrent/ftplugin
    sudo cp -r $GOROOT/misc/vim/ftdetect /usr/share/vim/vimcurrent/

in some case, vimrc should set the filetype

    au BufRead,BufNewFile *.go set filetype=go

###json解析问题

如下的场景应该是比较熟悉的json解析方式
    
    type Book struct {
        Title   string
        Author  string
    }
    b := [] byte('{"Title": "go", "Author": "jgj"}')
    var book Book
    err := json.Unmarshal(b, &book)
    
这样就将json中的内容填充到了额book变量中，期间的匹配解析过程就不多介绍。有个问题，如果字符串中的key是 "_title" 或者 "1" ，那如果处理呢。  
要知道，go中要使用大写才是public的，这种情况下，可以如下表示

        type Book struct {
        Title   string `json:"_title"`
        Author  string
    }
    
即使用`json:"xxx"`的方式指定匹配那个key，这种方式可以使用与各种情况。       
