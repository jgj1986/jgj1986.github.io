---
title: nginx使用笔记
date: 2014-11-28 15:12:28 +0800
tags: web 
- a
- b
---

* toc 
{:toc}

>本文记录在nginx使用过程中的点滴。

###身份验证

[Nginx 配置指令的执行顺序](http://blog.sina.com.cn/s/blog_6d579ff401010gp3.html){:target="_blank"}介绍到nginx的处理请求的过程一共划分为 11 个阶段，依次是：
post-read、server-rewrite、find-config、rewrite、post-rewrite、preaccess、access、post-access、try-files、content 以及 log，而最重要的是rewrite,access和content。
所以我们可以在access阶段做验证操作，相关的逻辑处理放到content中实现。

配置

    server {
        access_by_lua_file /path/to/access_ctrl.lua;
    
        location = /test {
            content_by_lua_file /path/to/test.lua;
        }
    }
    
access_trl.lua中的实现样式

    local req_headers = ngx.req.get_headers()

    local key = req_headers["key"]
    if nil == key or "TEST" ~= key then
        ngx.exit(600)  -- 验证没有通过的状态码
    end

    return
    
    
    
