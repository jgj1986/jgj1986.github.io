---
title: 时间操作函数
date: 2015-02-16 15:12:28
tags: 语言 
- a
- b
---

* toc 
{:toc}

>最近在编码过程中，经常有时间的操作，主要的是年月日时分秒 与 秒 的转化。

## 年月日时分秒 转为 时间戳
说明，在文档中，默认的时间格式为 “YYYY-mm-dd HH:MM:ss”，秒为本地的秒数；如果是标准秒数会明确标识出来。    

### shell

  $ date +%s
    $ date -d "2015-02-16 15:12:28" +%s
    $ date --date="1 hour ago" +%s
    
### python

    #!/usr/bin/python
    import time
    
    # time.time() 1970纪元后经过的浮点秒数
    print str(time.time()).split('.')[0] # 所以想只要整数型秒数，就去掉.后面
    
    struct_time = time.strptime("2015-02-16 15:12:28","%Y-%m-%d %H:%M:%S")
    print str(time.mktime(struct_time)).split('.')[0]

### c/c++

    #include <sys/time.h>   
    
    // 获取当前时间的毫秒数
    long currentMsec() {
    struct timeval tv; 
    gettimeofday(&tv,NULL);
    return tv.tv_sec * 1000 + tv.tv_usec / 1000;
    // return tv.tv_sec;  // 获取秒数
    }
    
    // "2015-02-16 15:12:28" 转为秒数
    long getSec(const char *date_str) { // 最好再有对date_str的检查！
        struct tm time;
        memset(&tim, 0, sizeof(time));  // 要清0
        strptime(date_str, "%Y-%m-%d %H:%M:%S", &time);
        //time_t loctime = mktime(&time);
        return (long)mktime(&time);
    }

最好看看几个结构体，`tm` 、 `timeval` 、 `time_t`

### golang

    package main
    import (
        "fmt"
        "time"
    )
    
    func main() {
        print time.Now().Unix()  // 当前时间戳(秒)
        // str 转为时间戳 -- 比较麻烦
        the_time := time.Date(2015, 2, 16, 15, 12, 28, 0, time.Local)
        unix_time := the_time.Unix()
        fmt.Println(unix_time)
        
        // 
        the_time, err := time.Parse("2006-01-02 15:04:05", "2014-01-08 09:04:41")
        if err == nil {
        unix_time := the_time.Unix()
        fmt.Println(unix_time)     
        }
    }
    
后面的例子参考 [golang -- 时间日期总结](http://my.oschina.net/1123581321/blog/190942){:target="_blank"}。

### lua

lua中可以使用 `time = os.time(tab)`的方式由年月日转为时间戳，这要就必须生成好 table。
下面例子中 `isdst` 表示是否是夏令时。

    print (os.time())  -- 当前时间戳
    local dayres = os.time({day=16,month=2,year=2015,hour=15,min=12,sec=28,isdst=false}) -- 年月日-> 时间戳
    
### java
 
 暂无 :)
 
 
## 时间戳转年月日时分秒

### shell

    date "+%Y-%m-%d %H:%M:%S"
    date -d @1424070748  "+%Y-%m-%d %H:%M:%S"  
    
### python

    import datetime
    import time
    
    timeStr = time.strftime('%Y-%m-%d %H:%M:%S',time.localtime(time.time())) 
    print timeStr
    
    ltime=time.localtime(1424070748)
    timeStr=time.strftime("%Y-%m-%d %H:%M:%S", ltime)
    print timeStr   
    
### c/c++

    #include <sys/time.h>
    
    void smp2date(long timestamp) { // 1424070748
        //time_t lt= time(NULL); // 当前时间
        time_t lt = timestamp; 
        
        // 比较啰嗦
        tm *t1 = localtime(&lt);
        cout << t1->tm_year+1900 << "-" << t1->tm_month + 1 << t1->tm_day << endl;      
        // tm *t2 = gmtime(&lt); // 世界标准时间
        
        char * date = new char[20];
        strftime(date, sizeof(date), "%Y-%m-%d %H:%M:%S", localtime(&t1));
        // date  即是
    }   
    
### golang

    package main
    import (
        "fmt"
        "time"
    )
    
    func main() {
        fmt.Println(time.Now().Format("2006-01-02 15:04:05"))   // 当前时间戳
        
        str_time := time.Unix(1424070748, 0).Format("2006-01-02 15:04:05")
        fmt.Println(str_time)
    }
    
### lua 

    print(os.date("%Y-%m-%d %H:%M:%S"))  // 当前时间戳
    print(os.date("%Y-%m-%d %H:%M:%S", 1424070748))
    
    
