---
title:  zabbix问题
date: 2014-12-03 10:12:28 +0800
tags: 运维 
- a
- b
---

* toc 
{:toc}

>zabbix监控告警，Agent on host [] unreached for 5 minutes，尝试使用了几种方式均没有成功。后来索性将这个给关掉了，这个记录下做过的尝试，或许对以后有多帮助


###修改模板

    组态
     Template(模板)
       Template App Zabbix Agent
         触发器
            Zabbix agent on {HOST.NAME} is unreachable for 5 minutes
            
将表达式做修改，`nodata` 改为 `min`，即
    {Template App Zabbix Agent:agent.ping.nodata(5m)}=1
    ->
    {Template App Zabbix Agent:agent.ping.min(5m)}=1

###修改hostname

网上的很多资料都说将hostname和zabbix配置中的host保持一致，依照这些说明做调整，也是不生效。   
说明下，该监控项以前是很正常工作的，晚上时候dns服务出现问题，导致告警，待把dns服务启动后，zabbix server和agentd都重启了，仍然有这个告警。
    
###去掉ServerActive

关闭掉`zabbix_agentd.conf`中指明的 `zabbix_agentd.conf`

尝试了这么几种办法，都不生效，暂时木有找到办法！

## 大体流程

最近遇到了一个问题：server端使用的dns服务出现了问题，导致告警的邮件短信没有及时发送出去，后来将dns问题修复后，监控的已经没有问题了，却在很疯狂的发送短信。什么原因呢，梳理了一下监控的流程：

监控的类型比较多，这里只说我们要用的这种形式。zabbix server根据配置的情况（存在mysql中），定期的扫描要监控的服务，当发现有需要告警时，会根据配置信息，调用告警的脚本（或语句），并且做一记录(存放alerts表)。因为server的网络有问题，告警未能及时发送出去，Linux系统层将这些任务存放在 /var/spool/mail/zabbix列表中。好了，当zabbix服务启动后，系统识别到有zabbix用户在使用了，于是就开始执行未尽的任务 -- 发短信、邮件了。删除 /var/spool/mail/zabbix 后就好了。


